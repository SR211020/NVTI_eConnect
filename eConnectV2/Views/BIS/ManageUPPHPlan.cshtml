@model eConnectV2.ViewModels.BISViewModel
@{
    ViewData["Title"] = "Manage UPPH Plan";
    ViewBag.Module = "UPPH";
    ViewBag.Category1 = "Plan";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section HeadBlock {
    <link rel="stylesheet" media="screen, print" href="~/css/datagrid/datatables/datatables.bundle.css">
    <link rel="stylesheet" media="screen, print" href="~/css/fa-solid.css">
}
<div class="panel">
    <div class="panel-hdr bg-primary-800 min-height-reset height-3">
        <h2 class="justify-content-center">
            <span class="fw-300 pr-1">Manage </span> UPPH Plan
        </h2>
    </div>
    <div class="panel-container show">
        <div class="panel-content">
            @using (Html.BeginForm("ManageUPPHPlan", "BIS", FormMethod.Post, new { id = "form", @class = "needs-validation", enctype = "multipart/form-data", novalidate = "novalidate" }))
            {
                <div class="panel-content">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Plant</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="Plant" type="text" readonly class="form-control" />
                                    <input asp-for="DocNo" type="hidden" value="0" />
                                    <input asp-for="hdnField1" type="hidden" />
                                    <input asp-for="hdnField2" type="hidden" />
                                    <input asp-for="hdnField3" type="hidden" />
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Division</label>
                                <div class="col-sm-8">
                                    <select asp-for="Division" class="select2 custom-select form-control w-100" required>
                                        <option value="">-- Select --</option>
                                        <option value="PACK">PACK</option>
                                        <option value="BE">SMT</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Line No</label>
                                <div class="col-sm-8">
                                    <select asp-for="LineNo" class="select2 custom-select w-100" required asp-items="@(new SelectList(Model.LineNoList, "Value", "Text"))">
                                        <option value="">-- Select --</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Model Name</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="ModelName" type="text" required class="form-control" autocomplete="off">
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Line Type</label>
                                <div class="col-sm-8">
                                    <select asp-for="LineType" class="select2 custom-select form-control w-100" required>
                                        <option value="">-- Select --</option>
                                        <option value="GA">GA</option>
                                        <option value="G3">G3</option>
                                        <option value="V3">V3</option>
                                        <option value="SA">Semi-Auto</option>
                                        <option value="M">Manual</option>
                                        <option value="PB10K">PB10K</option>
                                        <option value="PB20K">PB20K</option>
                                        <option value="EV">EV</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Customer</label>
                                <div class="col-sm-8">
                                    <select asp-for="CustomerName" class="select2 custom-select form-control w-100" required>
                                        <option value="">-- Select --</option>
                                        <option value="SSE">SSE</option>
                                        <option value="BBK">BBK</option>
                                        <option value="MIX">MIX</option>
                                        <option value="OPO">OPO</option>
                                        <option value="MTO">MTO</option>
                                        <option value="TSN">TSN</option>
                                        <option value="ZIM">ZIM</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Shift</label>
                                <div class="col-sm-8 align-self-center">
                                    <select asp-for="Shift" class="select2 custom-select w-100" required asp-items="@(new SelectList(Model.ShiftList, "Value", "Text"))">
                                        <option value="">-- Select --</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Plan</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="Plan" type="number" required class="form-control" autocomplete="off">
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">UPH</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="UphTarget" type="number" required class="form-control" autocomplete="off">
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">UPPH</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="UpphTarget" type="number" required class="form-control" min="0" value="0" step=".01" autocomplete="off">
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Standard HC</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="StdHC" type="number" required class="form-control" autocomplete="off">
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Actual HC</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="ActualHC" type="number" required class="form-control" autocomplete="off">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Variance 1</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="Variance1" type="number" class="form-control" autocomplete="off">
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Variance 2</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="Variance2" type="number" class="form-control" autocomplete="off">
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Variance 3</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="Variance3" type="number" class="form-control" autocomplete="off">
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Variance 4</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="Variance4" type="number" class="form-control" autocomplete="off">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Variance 5</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="Variance5" type="number" class="form-control" autocomplete="off">
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Variance 6</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="Variance6" type="number" class="form-control" autocomplete="off">
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Variance 7</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="Variance7" type="number" class="form-control" autocomplete="off">
                                </div>
                            </div>
                            <div class="row p-1">
                                <label class="col-sm-4 col-form-label">Variance 8</label>
                                <div class="col-sm-8 align-self-center">
                                    <input asp-for="Variance8" type="number" class="form-control" autocomplete="off">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row pt-2">
                        <div class="col-md-4"></div>
                        <div class="col-md-4">
                            <div class="row p-1">
                                <div class="col-sm-4"></div>
                                <div class="col-sm-8">
                                    <button id="btnSave" type="submit" name="submit" class="btn btn-primary btn-sm">Submit</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4"></div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>


<div class="row">
    <div class="col-md-12">
        <div id="panel-1" class="panel">
            <div class="panel-container show">
                <div class="panel-content">
                    <div class="table-responsive">
                        <table id="dt-hs" class="table w-100 table-bordered table-sm table-hover table-striped nowrap ">
                            <thead class="bg-primary-800">
                                <tr class='notexport text-nowrap'>
                                    <th class="notexport">Action</th>
                                    <th>Division</th>
                                    <th>Customer</th>
                                    <th>Line No</th>
                                    <th>Line Type</th>
                                    <th>Model Name</th>
                                    <th>Shift</th>
                                    <th>Plan</th>
                                    <th>UPH</th>
                                    <th>Std HC</th>
                                    <th>Actual HC</th>
                                    <th>UPPH</th>
                                    <th>Variance 1</th>
                                    <th>Variance 2</th>
                                    <th>Variance 3</th>
                                    <th>Variance 4</th>
                                    <th>Variance 5</th>
                                    <th>Variance 6</th>
                                    <th>Variance 7</th>
                                    <th>Variance 8</th>
                                    <th>IsActive</th>
                                    <th>Date</th>
                                    <th>User Id</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.dt != null && Model.dt.Rows.Count > 0)
                                {
                                    @foreach (DataRow row in Model.dt.Rows)
                                    {
                                        <tr>
                                            <td class="text-center">
                                                <a title='Edit' href='javascript:void(0)' onclick='FillUPPHMasterData("@row["SRNO"]")'><i class="fa fa-edit mr-3"></i></a>
                                            </td>
                                            <td>
                                                @row["DIVISION"]
                                            </td>
                                            <td>@row["CUSTOMER"]</td>
                                            <td>@row["LINE_NO"]</td>
                                            <td>@row["LINE_TYPE"]</td>
                                            <td>@row["MODEL_NAME"]</td>
                                            <td>@row["SHIFT"]</td>
                                            <td>@row["PLAN"]</td>
                                            <td>@row["UPH"]</td>
                                            <td>@row["STD_HC"]</td>
                                            <td>@row["ACTUAL_HC"]</td>
                                            <td>@row["UPPH"]</td>
                                            <td>@row["VARIANCE1"]</td>
                                            <td>@row["VARIANCE2"]</td>
                                            <td>@row["VARIANCE3"]</td>
                                            <td>@row["VARIANCE4"]</td>
                                            <td>@row["VARIANCE5"]</td>
                                            <td>@row["VARIANCE6"]</td>
                                            <td>@row["VARIANCE7"]</td>
                                            <td>@row["VARIANCE8"]</td>
                                            <td>
                                                @if (row["ISACTIVE"].ToString() == "Y")
                                                {
                                                    <a title='Active' href='javascript:void(0)' onclick='UpdateStatus("@row["SRNO"]", "N")'><i class="fas fa-check fa-1x text-success"></i></a>
                                                }
                                                else
                                                {
                                                    <a title='Inactive' href='javascript:void(0)' onclick='UpdateStatus("@row["SRNO"]", "Y")'><i class="fas fa-times fa-1x text-danger"></i></a>
                                                }
                                            </td>
                                            <td>@row["TDATE"]</td>
                                            <td>@row["USERID"]</td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section ScriptsBlock {
    <script src="~/js/datagrid/datatables/dths_excel.js"></script>
    <script src="~/js/datagrid/datatables/datatables.export.js"></script>
    <script src="~/js/datagrid/datatables/datatables.bundle.js"></script>

    <script>
        //// Get QueryString ////
        //const urlParams = new URLSearchParams(window.location.search);
        //const param = urlParams.get('plant').toUpperCase();
        //var val1 = param == "MN" ? "MANESAR" : "BAWAL";

        //// Drop Down Events ////
        $(document).ready(function () {
            $(function () {
                $('.select2').select2();

                if ($("#Division").val() != null) {
                    FillLineByDivision($("#Division").val(), '@Model.LineNo');
                }
            });

            $('#Division').on('select2:select', function (e) {
                FillLineByDivision(e.params.data.id, 0);
            });
        });

        //// Fill LineNo By Divison ////
        function FillLineByDivision(DivisionName, LineNo = 0) {
            $("#LineNo").empty();
            var requestUrl = 'BIS/FillLineByDivision';
            $.post(requestUrl,
                {
                    plant: $('#Plant').val(),
                    division: DivisionName
                },
                function (data) {
                    $.each(data.lineNoList, function (index, item) {
                        $("#LineNo").append($("<option></option>").val(item.value).html(item.text));
                    });
                    if (LineNo != 0) {
                        $("#LineNo").val(LineNo);
                    }
                });
        }

        function FillUPPHMasterData(srno) {
            var requestUrl = 'BIS/FillUPPHDataBySrNo';
            $.post(requestUrl,
                {
                    plant: $('#Plant').val(),
                    docno: srno
                },
                function (model) {
                    $("#DocNo").val(model.docNo);
                    $("#Division").val(model.division).change();
                    $("#hdnField1").val(model.division);

                    FillLineByDivision($('#Division').val(), model.lineNo);
                    $("#LineNo").val(model.lineNo).change();
                    $("#hdnField2").val(model.lineNo);

                    $("#LineType").val(model.lineType).change();
                    $("#CustomerName").val(model.customerName).change();
                    //$("#LineType").select2("val", $("#LineType option:contains(" + model.lineType + ")").val());
                    $("#Shift").val(model.shift).change();
                    $("#hdnField3").val(model.shift);

                    $("#ModelName").val(model.modelName);
                    $("#Plan").val(model.plan);
                    $("#UphTarget").val(model.uphTarget);
                    $("#StdHC").val(model.stdHC);
                    $("#ActualHC").val(model.actualHC);
                    $("#UpphTarget").val(model.upphTarget);
                    $("#Variance1").val(model.variance1);
                    $("#Variance2").val(model.variance2);
                    $("#Variance3").val(model.variance3);
                    $("#Variance4").val(model.variance4);
                    $("#Variance5").val(model.variance5);
                    $("#Variance6").val(model.variance6);
                    $("#Variance7").val(model.variance7);
                    $("#Variance8").val(model.variance8);

                    $("#Division").prop("disabled", true);
                    $("#LineNo").prop("disabled", true);
                    $("#Shift").prop("disabled", true);

                    if ($("#DocNo").val() == 0) {
                        $("#btnSave").html("Submit");
                    }
                    else {
                        $("#btnSave").html("Update");
                    }
                });
        }

        function UpdateStatus(srno, status) {
            var requestUrl = 'BIS/UpdateStatus';
            $.post(requestUrl,
                {
                    plant: $('#Plant').val(),
                    docno: srno,
                    status: status
                },
                function (result) {
                    if (result.status == "1") {
                        window.location.reload();
                    }
                    else {
                        Swal.fire("Info!", result.msg , "error");
                    }
                });
        }
    </script>
}

